# Distributed Counter

이 예제에서는 기본적인 분산 카운터 앱을 만드는 과정을 안내합니다. Sui Move 모듈을 작성하고 이를 React 기반 Sui dApp과 연결하는 끝까지의 전체 흐름을 다룹니다. 이 앱은 사용자가 누구나 증가시킬 수 있는 카운터를 생성할 수 있게 해주며, 단 카운터를 리셋할 수 있는 권한은 소유자에게만 부여됩니다.

**가이드는 두 부분으로 나뉩니다.**

> 1.  스마트 컨트랙트: 카운터 구조체와 로직을 설정하는 Move 코드
> 2.  프론트엔드: 사용자가 카운터 객체를 생성하고, 증가시키며, 리셋할 수 있는 UI

<br>
이번 가이드는 Shared Objects에 대해서 다룹니다. Sui는 Object 중심의 Move 언어를 사용하며, 객체(Object)는 크게 Shared Objects와 Owned Objects로 나뉩니다.

> Shared Objects는 여러 사용자가 동시에 접근할 수 있으며, 전역적으로 공유 가능한 객체입니다.
>
> Owned Objects는 특정 계정이 소유하며, 소유자만이 직접 접근하고 변경할 수 있는 객체입니다.

예를 들어 포커 게임을 생각해볼 수 있습니다.

> Shared Objects: 테이블 위의 포커 덱처럼, 모든 플레이어가 접근하고 카드를 뽑을 수 있는 객체입니다.
>
> Owned Objects: 각 플레이어가 들고 있는 손패처럼, 오직 해당 플레이어만 접근하고 볼 수 있는 객체입니다.

이번 Distributed Counter에서는 Shared Objects를 사용하여 전역적으로 접근 가능한 카운터 객체(Counter objects)를 생성하고, 누구나 증가시킬 수 있도록 구현합니다.

## 1단계: 프로젝트 폴더 생성

시스템에서 새로운 폴더를 생성합니다.

```bash
mkdir distributed-counter
```

이 폴더는 프로젝트의 모든 파일을 담는 최상위 폴더입니다.
원하는 다른 이름으로 바꿔도 되지만, 이후 가이드에서는 이 구조를 기준으로 설명합니다.

## 2단계: Move 디렉토리 생성

```bash
mkdir ./move/counter/sources
```

`sources` 폴더에 move 코드가 작성될 것입니다.

## 3단계: Smart Contracts 작성

### 3-1: toml 파일 작성

스마트 컨트랙트를 작성하기 시작하려면, distributed-counter/move/counter 안에 `Move.toml` 파일을 생성하고, 다음 코드를 복사하여 붙여넣습니다.

```bash
[package]
name = "counter"
version = "0.0.1"
edition = "2024.beta"

[dependencies]
Sui = { git = "https://github.com/MystenLabs/sui.git", subdir = "crates/sui-framework/packages/sui-framework", rev = "framework/testnet" }

[addresses]
counter = "0x0"
```

`Move.toml`은 Move 패키지의 매니페스트 파일로, Move 모듈을 구성하고 관리하는 정보를 담고 있습니다.

### 1. [package]

패키지 자체의 기본 정보를 정의하는 필드입니다.

| 필드      | 설명                         | 예시 값       |
| --------- | ---------------------------- | ------------- |
| `name`    | 패키지 이름                  | `"counter"`   |
| `version` | 패키지 버전                  | `"0.0.1"`     |
| `edition` | Move 언어 버전/패키지 에디션 | `"2024.beta"` |

> 💡 **간단 설명**: 이 패키지가 어떤 이름과 버전으로 존재하는지, 어떤 Move 에디션을 사용하는지 알려주는 설정입니다.

### 2. [dependencies]

패키지가 의존하는 다른 Move 패키지나 라이브러리를 선언하는 필드입니다. 예제에서는 Sui 패키지를 Git 리포지토리에서 가져오도록 설정합니다.

| 필드     | 설명                             | 예시 값                                         |
| -------- | -------------------------------- | ----------------------------------------------- |
| `git`    | 패키지 Git URL                   | `"https://github.com/MystenLabs/sui.git"`       |
| `subdir` | 해당 리포지토리 내의 패키지 경로 | `"crates/sui-framework/packages/sui-framework"` |
| `rev`    | 사용할 브랜치나 커밋             | `"framework/testnet"`                           |

> 💡 **간단 설명**: 내 패키지가 다른 패키지(Sui 프레임워크)를 필요로 한다고 알려주는 설정입니다. `Distributed Counter`에서는 `transfer::share_object`를 사용하기 위해 Sui 프레임워크를 추가했습니다.

### 3. [addresses]

Move 패키지에서 사용할 전역 주소(Address) 매핑을 정의하는 필드입니다.

| 설정              | 설명                              |
| ----------------- | --------------------------------- |
| `counter = "0x0"` | counter 모듈이 배포될 주소를 지정 |

> ⚠️ **참고**: 이후 배포 시 실제 계정 주소로 변경할 수 있습니다.

> 💡 **간단 설명**: Move 모듈이 블록체인 상 어디에 위치할지 지정하는 설정입니다.

### 3-2 `counter.move` 파일 생성 및 `module` 정의

distributed-counter/move/counter/sources 안에 `counter.move` 파일을 생성합니다.
파일 안에 아래 코드를 작성합니다.

```rust
module counter::counter;
```

`counter::counter는` 패키지 이름(counter)과 모듈 이름(counter)을 `::`로 구분한 네임스페이스입니다.

- 첫 번째 counter: 패키지 이름 (Move.toml의 `[package] name = "counter"`)

- 두 번째 counter: 모듈 이름, 이 안에 스마트 컨트랙트 로직을 작성

즉, “이 패키지 안에 counter라는 모듈을 만들겠다”라는 선언입니다.

> 패키지(Package) <br>
> 패키지 = Move 모듈들의 묶음 + 메타데이터
>
> Move.toml 파일로 정의하며, 하나의 패키지 안에는 여러 모듈을 포함할 수 있습니다.
>
> 패키지는 배포 단위입니다. 블록체인에 배포할 때 패키지 단위로 빌드 및 배포합니다.
>
> 예시: counter 패키지 → Counter 모듈이 들어 있는 패키지

> 모듈(Module) <br>
> 모듈 = 스마트 컨트랙트 또는 기능 단위 코드
>
> 패키지 안에서 정의하며, struct와 함수들을 포함합니다.
>
> 모듈 안에서 정의한 함수와 구조체는 다른 모듈이나 외부에서 불러서 사용할 수 있습니다.
>
> 예시: counter::counter 모듈 → Counter struct, increment(), reset() 함수 포함

### 3-3 `Counter` struct 생성

```rust
public struct Counter has key {
  id: UID,
  owner: address,
  value: u64
}
```

`Counter` 타입은 그 소유자의 주소(`owner`), 현재 상태(`value`), 그리고 자신의 아이디(`id`)을 저장한다.

`has key` + `id` 덕분에 `Counter` 객체는 누가 소유하고 어떤 값인지 정확히 관리 가능합니다.

> - `has key`: 이 구조체는 블록체인에서 고유하게 식별 가능한 객체임을 의미
>
> - `id`: `UID`: 객체마다 중복 없는 고유 ID를 가지고 있음 → 블록체인이 객체를 추적 가능

Move에서는 모든 자산과 데이터가 객체(Object) 단위로 소유권과 상태를 명확히 관리되도록 설계되어 있습니다. Sui에서 객체는 has key와 UID 덕분에 블록체인 상에서 누가 소유하고 있는지, 그리고 현재 값이 무엇인지 정확히 관리할 수 있습니다. 이는 소유자 권한 관리, 상태 추적, 동시성 처리, 데이터 일관성을 보장하는 데 필수적입니다.
